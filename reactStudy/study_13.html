<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/react/15.4.2/react.min.js"></script>
    <script src="https://cdn.bootcss.com/react/15.4.2/react-dom.min.js"></script>
    <script src="https://cdn.bootcss.com/babel-standalone/6.22.1/babel.min.js"></script>
    <script src="https://npmcdn.com/babel-core@5.8.38/browser.min.js"></script>
    <script src="https://cdn.bootcss.com/pubsub-js/1.7.0/pubsub.js"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <style>
        *{margin:0;padding:0;}
        #contener{width:800px;height:500px;margin:30px auto;position:relative;
            border:1px solid #ddd;overflow-y: hidden;}
        ul{list-style: none;position: absolute;top:0;left:0;}
        ul>li{width:150px;height:30px;margin-bottom:10px;}
        .scrollBar{width:12px;height:490px;position:absolute;right:4px;top:5px;
            background-color: transparent;border-radius:10px;border:1px solid #ddd;
            padding:1px;
        }
        .scrollBar>.bar{width:8px;min-height:20px;border-radius:10px;background:#999;
            position:absolute;}
    </style>
</head>
<body>
    <div id="contener">
        <ul id="content">
            <!--<li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>-->
        </ul>
        <div class="scrollBar">
            <p class="bar" id="js_bar"></p>
        </div>
    </div>
</body>
<script>
$(function(){
    let bar = new ScrollBar();

        bar.init();
        $("#contener").on('wheel',bar.scroll);
        $("#js_bar").on('mousedown',bar.moveScroll);//点击滚动条进行滑动
        $(".scrollBar").on('click',bar.barClick);//点击滚动条空白处
});
class ScrollBar{
    constructor(){
        let self = this;
        let colorArr = ['red','yellow','blue','green','pink','purple'];

        this.contentHeight = '';//总体内容高度
        this.boxHeight = '';//页面框的高度
        this.overflowHeight = '';//计算内容是否超过了页面框高度
        this.sideBarOutHeight = '';//滚动条外部的框的高度
        this.barHeight = '';//滚动条的高度
        this.aLiHeight = '';//子元素的高度
        this.disY = null;//记录滚动条的偏移量

        //初始化加载数据
        this.init = function(){
            let oLi = '';
            let barHeight = '';//超过页面框的内容高度
            for(let i = 1;i<=30;i++){
                oLi += `<li>${i}</li>`;
            }
            $('#content').html(oLi);
            $('#content>li').each(function () {
                this.style.background = colorArr[$(this).index() % colorArr.length];
            });

            self.contentHeight = $('#content').height();//总体内容高度
            self.boxHeight = $('#contener').height();//页面框的高度
            self.overflowHeight = self.contentHeight - self.boxHeight;//计算内容是否超过了页面框高度

            self.sideBarOutHeight = $('.scrollBar').height();
           // console.log(self.sideBarOutHeight);
            if(self.contentHeight <= self.boxHeight ){
                $(".scrollBar").hide();
            }else{
                $(".scrollBar").show();

                barHeight = self.sideBarOutHeight-(self.overflowHeight / self.contentHeight)*self.sideBarOutHeight + 'px' ;
                $('.bar').css({height:barHeight});
            }
            self.aLiHeight = $('li:first-child').height();
            self.barHeight = $("#js_bar").height();
        }

        this.scroll = function () {
            let ev = event || window.event;
            let top = '';
            let offsetTop = '';
            let step = 30;
            if(ev.wheelDelta < 0){
                top = '-='+step; //向上滚动
                if(self.boxHeight >= self.contentHeight){//内容高度小于页面框高度
                    top = '0';
                }else{
                    offsetTop = $('#content').position().top;//当前内容已滚动的距离
                    if(Math.abs(offsetTop) + self.boxHeight >= self.contentHeight){
                        top = offsetTop;
                    }
                }
            }else{
                top = '+='+step;//向下滚动
                offsetTop = $('#content').position().top;
                if(offsetTop >=0){
                    top = '0';
                }
            }
//            console.log(offsetTop);
            $('#content').css({top:top});

            offsetTop = $('#content').position().top;
            let t = -(offsetTop / self.overflowHeight) * (self.sideBarOutHeight - self.barHeight);
//            console.log(t);
            if(t <= 0){
                t = 0;
            }else if(t >= self.sideBarOutHeight - self.barHeight){
                t = self.sideBarOutHeight - self.barHeight;
            }
            $('#js_bar').css({top:t});
        }

        this.moveScroll = function () {
            let ev = event || window.event;
            let _this = this;
            self.disY = ev.clientY - $(this).position().top;

            document.onmousemove = function (ev) {
                let event = ev || window.event;
                let t = event.clientY - self.disY;
                if(t <= 0){
                    t = 0;
                }else if(t >= self.sideBarOutHeight - self.barHeight){
                    t = self.sideBarOutHeight - self.barHeight;
                }

                $(_this).css({top:t});

                let blankHeight = self.sideBarOutHeight - self.barHeight;//滚动条空白的高度
                let percentage = -(t / blankHeight)*self.overflowHeight ;//滚动的空白比计算隐藏内容滚动值
                $('#content').css({top:percentage});
//                console.log(t);

            }
            document.onmouseup = function () {
                document.onmouseup = null;
                document.onmousemove = null;
            }
            return false;
        }

        this.barClick = function () {
            let ev = event || window.event;
            let offsetTop = $('.scrollBar').offset().top;
            let barY = ev.clientY - offsetTop - self.barHeight / 2;

            if(barY <= 0){
                barY = 0;
            }else if(barY >= self.sideBarOutHeight - self.barHeight){
                barY = self.sideBarOutHeight - self.barHeight;
            }
//            console.log(barY);
            $('#js_bar').css({top:barY});
            let blankHeight = self.sideBarOutHeight - self.barHeight;//滚动条空白的高度
            let percentage = -(barY / blankHeight)*self.overflowHeight ;//滚动的空白比计算隐藏内容滚动值
            $('#content').css({top:percentage});
            return false;
        }
    }
}

</script>
</html>